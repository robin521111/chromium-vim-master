<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hints.create å‡½æ•°è°ƒè¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .section h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #007cba;
            padding-bottom: 5px;
        }
        .status {
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        
        .controls {
            margin: 20px 0;
        }
        .btn {
            background-color: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn:hover {
            background-color: #005a87;
        }
        .btn.danger {
            background-color: #dc3545;
        }
        .btn.danger:hover {
            background-color: #c82333;
        }
        
        .log-container {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        .log-entry {
            margin: 2px 0;
            padding: 2px 5px;
            border-radius: 2px;
        }
        .log-entry.error { background-color: #f8d7da; }
        .log-entry.success { background-color: #d4edda; }
        .log-entry.warning { background-color: #fff3cd; }
        .log-entry.info { background-color: #d1ecf1; }
        
        .test-links {
            margin: 20px 0;
        }
        .test-links a {
            display: inline-block;
            margin: 5px 10px;
            padding: 8px 15px;
            background-color: #e9ecef;
            color: #495057;
            text-decoration: none;
            border-radius: 4px;
            border: 1px solid #ced4da;
        }
        .test-links a:hover {
            background-color: #dee2e6;
        }
        
        .debug-info {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Hints.create å‡½æ•°è°ƒè¯•å·¥å…·</h1>
        
        <div class="section">
            <h3>ğŸ“‹ è°ƒè¯•æ§åˆ¶</h3>
            <div class="controls">
                <button class="btn" onclick="debugHintsCreate()">ğŸš€ è°ƒè¯• Hints.create</button>
                <button class="btn" onclick="testBasicFunctionality()">ğŸ”§ æµ‹è¯•åŸºç¡€åŠŸèƒ½</button>
                <button class="btn" onclick="checkDependencies()">ğŸ“¦ æ£€æŸ¥ä¾èµ–</button>
                <button class="btn" onclick="simulateFKey()">âŒ¨ï¸ æ¨¡æ‹ŸFé”®</button>
                <button class="btn danger" onclick="clearLogs()">ğŸ—‘ï¸ æ¸…é™¤æ—¥å¿—</button>
            </div>
        </div>
        
        <div class="section">
            <h3>ğŸ”— æµ‹è¯•é“¾æ¥</h3>
            <div class="test-links">
                <a href="#test1">æµ‹è¯•é“¾æ¥ 1</a>
                <a href="#test2">æµ‹è¯•é“¾æ¥ 2</a>
                <a href="#test3">æµ‹è¯•é“¾æ¥ 3</a>
                <a href="https://www.google.com">Google</a>
                <a href="https://www.github.com">GitHub</a>
                <button onclick="alert('æŒ‰é’®ç‚¹å‡»')">æµ‹è¯•æŒ‰é’®</button>
                <input type="text" placeholder="æµ‹è¯•è¾“å…¥æ¡†">
                <select><option>æµ‹è¯•é€‰æ‹©æ¡†</option></select>
            </div>
        </div>
        
        <div class="section">
            <h3>ğŸ“Š æ‰§è¡ŒçŠ¶æ€</h3>
            <div id="execution-status"></div>
        </div>
        
        <div class="section">
            <h3>ğŸ“ è¯¦ç»†æ—¥å¿—</h3>
            <div id="debug-log" class="log-container"></div>
        </div>
        
        <div class="section">
            <h3>ğŸ” è°ƒè¯•ä¿¡æ¯</h3>
            <div id="debug-info" class="debug-info"></div>
        </div>
    </div>

    <script>
        let logContainer = document.getElementById('debug-log');
        let statusContainer = document.getElementById('execution-status');
        let debugInfoContainer = document.getElementById('debug-info');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function updateStatus(message, type = 'info') {
            statusContainer.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        function updateDebugInfo() {
            let info = '';
            
            // æ£€æŸ¥å…³é”®å¯¹è±¡
            info += '=== å…³é”®å¯¹è±¡çŠ¶æ€ ===\n';
            info += `window.Hints: ${typeof window.Hints}\n`;
            if (typeof window.Hints !== 'undefined') {
                info += `  Hints.active: ${window.Hints.active}\n`;
                info += `  Hints.create: ${typeof window.Hints.create}\n`;
                info += `  Hints.linkArr: ${window.Hints.linkArr ? window.Hints.linkArr.length : 'undefined'}\n`;
                info += `  Hints.linkHints: ${window.Hints.linkHints ? window.Hints.linkHints.length : 'undefined'}\n`;
            }
            
            info += `\nwindow.Command: ${typeof window.Command}\n`;
            if (typeof window.Command !== 'undefined') {
                info += `  Command.loaded: ${window.Command.loaded}\n`;
                info += `  Command.domElementsLoaded: ${window.Command.domElementsLoaded}\n`;
                info += `  Command.css: ${window.Command.css ? 'exists' : 'null'}\n`;
                info += `  Command.mainCSS: ${window.Command.mainCSS ? 'exists' : 'undefined'}\n`;
            }
            
            info += `\nwindow.settings: ${typeof window.settings}\n`;
            if (typeof window.settings !== 'undefined') {
                info += `  settings.hintcharacters: ${window.settings.hintcharacters}\n`;
                info += `  settings.numerichints: ${window.settings.numerichints}\n`;
                info += `  settings.typelinkhints: ${window.settings.typelinkhints}\n`;
                info += `  settings.linkanimations: ${window.settings.linkanimations}\n`;
            }
            
            // æ£€æŸ¥DOMå…ƒç´ 
            info += '\n=== DOM çŠ¶æ€ ===\n';
            const container = document.getElementById('rVim-link-container');
            info += `rVim-link-container: ${container ? 'exists' : 'not found'}\n`;
            if (container) {
                info += `  children: ${container.children.length}\n`;
                info += `  style.opacity: ${container.style.opacity}\n`;
                info += `  style.display: ${container.style.display}\n`;
            }
            
            // æ£€æŸ¥é¡µé¢é“¾æ¥
            const links = document.querySelectorAll('a, button, input, select, [onclick]');
            info += `\né¡µé¢å¯ç‚¹å‡»å…ƒç´ æ•°é‡: ${links.length}\n`;
            
            debugInfoContainer.textContent = info;
        }
        
        function clearLogs() {
            logContainer.innerHTML = '';
            statusContainer.innerHTML = '';
            log('æ—¥å¿—å·²æ¸…é™¤');
        }
        
        function checkDependencies() {
            log('=== æ£€æŸ¥ä¾èµ– ===');
            updateStatus('æ£€æŸ¥ä¾èµ–ä¸­...', 'info');
            
            const dependencies = [
                'window.Hints',
                'window.Hints.create',
                'window.Command',
                'window.settings',
                'window.DOM',
                'window.HUD'
            ];
            
            let allGood = true;
            dependencies.forEach(dep => {
                const parts = dep.split('.');
                let obj = window;
                let exists = true;
                
                for (let part of parts.slice(1)) {
                    if (obj && typeof obj[part] !== 'undefined') {
                        obj = obj[part];
                    } else {
                        exists = false;
                        break;
                    }
                }
                
                if (exists) {
                    log(`âœ… ${dep}: å­˜åœ¨ (${typeof obj})`, 'success');
                } else {
                    log(`âŒ ${dep}: ä¸å­˜åœ¨`, 'error');
                    allGood = false;
                }
            });
            
            if (allGood) {
                updateStatus('âœ… æ‰€æœ‰ä¾èµ–æ£€æŸ¥é€šè¿‡', 'success');
            } else {
                updateStatus('âŒ éƒ¨åˆ†ä¾èµ–ç¼ºå¤±', 'error');
            }
            
            updateDebugInfo();
        }
        
        function testBasicFunctionality() {
            log('=== æµ‹è¯•åŸºç¡€åŠŸèƒ½ ===');
            updateStatus('æµ‹è¯•åŸºç¡€åŠŸèƒ½ä¸­...', 'info');
            
            try {
                // æµ‹è¯•Hintså¯¹è±¡
                if (typeof window.Hints === 'undefined') {
                    throw new Error('Hintså¯¹è±¡æœªå®šä¹‰');
                }
                log('âœ… Hintså¯¹è±¡å­˜åœ¨', 'success');
                
                // æµ‹è¯•createæ–¹æ³•
                if (typeof window.Hints.create !== 'function') {
                    throw new Error('Hints.createæ–¹æ³•ä¸å­˜åœ¨');
                }
                log('âœ… Hints.createæ–¹æ³•å­˜åœ¨', 'success');
                
                // æµ‹è¯•å…¶ä»–å…³é”®æ–¹æ³•
                const methods = ['hideHints', 'getLinks', 'evaluateLink'];
                methods.forEach(method => {
                    if (typeof window.Hints[method] === 'function') {
                        log(`âœ… Hints.${method}æ–¹æ³•å­˜åœ¨`, 'success');
                    } else {
                        log(`âš ï¸ Hints.${method}æ–¹æ³•ä¸å­˜åœ¨`, 'warning');
                    }
                });
                
                updateStatus('âœ… åŸºç¡€åŠŸèƒ½æµ‹è¯•å®Œæˆ', 'success');
                
            } catch (error) {
                log(`âŒ åŸºç¡€åŠŸèƒ½æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                updateStatus('âŒ åŸºç¡€åŠŸèƒ½æµ‹è¯•å¤±è´¥', 'error');
            }
            
            updateDebugInfo();
        }
        
        function debugHintsCreate() {
            log('=== å¼€å§‹è°ƒè¯• Hints.create ===');
            updateStatus('è°ƒè¯• Hints.create ä¸­...', 'info');
            
            try {
                // æ£€æŸ¥å‰ç½®æ¡ä»¶
                if (typeof window.Hints === 'undefined') {
                    throw new Error('Hintså¯¹è±¡æœªå®šä¹‰');
                }
                
                if (typeof window.Hints.create !== 'function') {
                    throw new Error('Hints.createä¸æ˜¯å‡½æ•°');
                }
                
                log('ğŸ“‹ å‰ç½®æ¡ä»¶æ£€æŸ¥é€šè¿‡', 'success');
                
                // è®°å½•è°ƒç”¨å‰çŠ¶æ€
                log(`è°ƒç”¨å‰çŠ¶æ€: Hints.active = ${window.Hints.active}`);
                
                // æ¸…ç†ä¹‹å‰çš„æç¤º
                const existingContainer = document.getElementById('rVim-link-container');
                if (existingContainer) {
                    log('ğŸ§¹ æ¸…ç†ç°æœ‰å®¹å™¨');
                    existingContainer.remove();
                }
                
                // è°ƒç”¨Hints.create
                log('ğŸš€ è°ƒç”¨ Hints.create()');
                window.Hints.create();
                
                // ç­‰å¾…ä¸€æ®µæ—¶é—´åæ£€æŸ¥ç»“æœ
                setTimeout(() => {
                    checkHintsResult();
                }, 500);
                
            } catch (error) {
                log(`âŒ è°ƒè¯•è¿‡ç¨‹ä¸­å‡ºé”™: ${error.message}`, 'error');
                log(`é”™è¯¯å †æ ˆ: ${error.stack}`, 'error');
                updateStatus('âŒ è°ƒè¯•å¤±è´¥', 'error');
            }
            
            updateDebugInfo();
        }
        
        function checkHintsResult() {
            log('=== æ£€æŸ¥ Hints.create æ‰§è¡Œç»“æœ ===');
            
            try {
                // æ£€æŸ¥å®¹å™¨æ˜¯å¦åˆ›å»º
                const container = document.getElementById('rVim-link-container');
                if (container) {
                    log('âœ… rVim-link-container å®¹å™¨å·²åˆ›å»º', 'success');
                    log(`å®¹å™¨å­å…ƒç´ æ•°é‡: ${container.children.length}`);
                    log(`å®¹å™¨é€æ˜åº¦: ${container.style.opacity}`);
                    
                    // æ£€æŸ¥æç¤ºå…ƒç´ 
                    const hints = container.querySelectorAll('.rVim-link-hint');
                    if (hints.length > 0) {
                        log(`âœ… åˆ›å»ºäº† ${hints.length} ä¸ªé“¾æ¥æç¤º`, 'success');
                        updateStatus(`âœ… æˆåŠŸåˆ›å»º ${hints.length} ä¸ªé“¾æ¥æç¤º`, 'success');
                        
                        // æ˜¾ç¤ºå‰å‡ ä¸ªæç¤ºçš„ä¿¡æ¯
                        for (let i = 0; i < Math.min(3, hints.length); i++) {
                            const hint = hints[i];
                            log(`  æç¤º ${i+1}: æ–‡æœ¬="${hint.textContent}" ä½ç½®=(${hint.style.left}, ${hint.style.top})`);
                        }
                    } else {
                        log('âš ï¸ å®¹å™¨å­˜åœ¨ä½†æ²¡æœ‰æç¤ºå…ƒç´ ', 'warning');
                        updateStatus('âš ï¸ å®¹å™¨åˆ›å»ºä½†æ— æç¤ºå…ƒç´ ', 'warning');
                    }
                } else {
                    log('âŒ rVim-link-container å®¹å™¨æœªåˆ›å»º', 'error');
                    updateStatus('âŒ å®¹å™¨æœªåˆ›å»º', 'error');
                }
                
                // æ£€æŸ¥HintsçŠ¶æ€
                if (typeof window.Hints !== 'undefined') {
                    log(`Hints.active: ${window.Hints.active}`);
                    log(`Hints.linkArré•¿åº¦: ${window.Hints.linkArr ? window.Hints.linkArr.length : 'undefined'}`);
                    log(`Hints.linkHintsé•¿åº¦: ${window.Hints.linkHints ? window.Hints.linkHints.length : 'undefined'}`);
                }
                
            } catch (error) {
                log(`âŒ æ£€æŸ¥ç»“æœæ—¶å‡ºé”™: ${error.message}`, 'error');
                updateStatus('âŒ æ£€æŸ¥ç»“æœå¤±è´¥', 'error');
            }
            
            updateDebugInfo();
        }
        
        function simulateFKey() {
            log('=== æ¨¡æ‹ŸFé”®æŒ‰ä¸‹ ===');
            updateStatus('æ¨¡æ‹ŸFé”®ä¸­...', 'info');
            
            try {
                // åˆ›å»ºé”®ç›˜äº‹ä»¶
                const event = new KeyboardEvent('keydown', {
                    key: 'f',
                    code: 'KeyF',
                    keyCode: 70,
                    which: 70,
                    bubbles: true,
                    cancelable: true
                });
                
                log('ğŸ“¤ å‘é€Fé”®äº‹ä»¶');
                document.dispatchEvent(event);
                
                // ç­‰å¾…å¤„ç†
                setTimeout(() => {
                    log('â±ï¸ Fé”®äº‹ä»¶å¤„ç†å®Œæˆ');
                    checkHintsResult();
                }, 300);
                
            } catch (error) {
                log(`âŒ æ¨¡æ‹ŸFé”®å¤±è´¥: ${error.message}`, 'error');
                updateStatus('âŒ æ¨¡æ‹ŸFé”®å¤±è´¥', 'error');
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', function() {
            log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹æ£€æŸ¥');
            setTimeout(() => {
                checkDependencies();
                updateDebugInfo();
            }, 1000);
        });
        
        // å®šæœŸæ›´æ–°è°ƒè¯•ä¿¡æ¯
        setInterval(updateDebugInfo, 2000);
    </script>
</body>
</html>