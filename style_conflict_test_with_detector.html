<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>插件样式冲突测试 - 带检测器</title>
    <style>
        /* 模拟常见网站样式 */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1, h2, h3 {
            color: #333;
            margin-bottom: 15px;
        }
        
        /* 测试高z-index元素 */
        .high-z-index {
            position: fixed;
            top: 50px;
            right: 50px;
            width: 200px;
            height: 100px;
            background: #e74c3c;
            color: white;
            padding: 20px;
            border-radius: 5px;
            z-index: 999999; /* 故意设置高z-index测试冲突 */
            text-align: center;
        }
        
        /* 测试固定定位冲突 */
        .fixed-bottom {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 150px;
            height: 50px;
            background: #3498db;
            color: white;
            padding: 10px;
            border-radius: 5px;
            z-index: 1000;
            text-align: center;
            line-height: 30px;
        }
        
        /* 测试模态框样式 */
        .modal-test {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
        }
        
        /* 测试导航栏 */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #2c3e50;
            color: white;
            padding: 15px 20px;
            z-index: 1001;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        /* 测试侧边栏 */
        .sidebar {
            position: fixed;
            left: 0;
            top: 60px;
            bottom: 0;
            width: 250px;
            background: #34495e;
            color: white;
            padding: 20px;
            z-index: 999;
            overflow-y: auto;
        }
        
        /* 测试工具提示 */
        .tooltip {
            position: absolute;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 12px;
            z-index: 10001;
            pointer-events: none;
        }
        
        /* 测试下拉菜单 */
        .dropdown {
            position: relative;
            display: inline-block;
        }
        
        .dropdown-content {
            position: absolute;
            background: white;
            min-width: 160px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            z-index: 1002;
            border-radius: 5px;
            display: none;
        }
        
        .dropdown:hover .dropdown-content {
            display: block;
        }
        
        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }
        
        .dropdown-content a:hover {
            background-color: #f1f1f1;
        }
        
        /* 测试按钮样式 */
        .test-buttons {
            margin: 20px 0;
        }
        
        .btn {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .btn:hover {
            background: #45a049;
        }
        
        .btn-danger {
            background: #f44336;
        }
        
        .btn-danger:hover {
            background: #da190b;
        }
        
        /* 测试表单元素 */
        .form-test {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        /* 测试链接样式 */
        .link-test {
            margin: 20px 0;
        }
        
        .link-test a {
            color: #3498db;
            text-decoration: none;
            margin: 0 10px;
            padding: 5px;
        }
        
        .link-test a:hover {
            text-decoration: underline;
            background: rgba(52, 152, 219, 0.1);
        }
        
        /* 测试内容区域 */
        .content-area {
            margin-left: 270px;
            margin-top: 80px;
            padding: 20px;
        }
        
        /* 响应式测试 */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .content-area {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <div class="navbar">
        <h2 style="margin: 0;">插件样式冲突测试 - 带自动检测</h2>
    </div>
    
    <!-- 侧边栏 -->
    <div class="sidebar">
        <h3>侧边栏</h3>
        <p>这是一个固定定位的侧边栏，用于测试与插件元素的位置冲突。</p>
        <ul style="list-style: none; padding: 0;">
            <li style="margin: 10px 0;"><a href="#" style="color: #ecf0f1;">菜单项 1</a></li>
            <li style="margin: 10px 0;"><a href="#" style="color: #ecf0f1;">菜单项 2</a></li>
            <li style="margin: 10px 0;"><a href="#" style="color: #ecf0f1;">菜单项 3</a></li>
        </ul>
    </div>
    
    <!-- 高z-index测试元素 -->
    <div class="high-z-index">
        <strong>高Z-Index元素</strong><br>
        z-index: 999999
    </div>
    
    <!-- 固定底部元素 -->
    <div class="fixed-bottom">
        固定底部元素
    </div>
    
    <!-- 模态框 -->
    <div class="modal-test" id="testModal">
        <div class="modal-content">
            <h3>测试模态框</h3>
            <p>这是一个高z-index的模态框，用于测试与插件元素的层级关系。</p>
            <button class="btn" onclick="hideModal()">关闭</button>
        </div>
    </div>
    
    <!-- 主内容区域 -->
    <div class="content-area">
        <h1>样式冲突检测测试页面</h1>
        
        <div class="test-buttons">
            <button class="btn" onclick="showModal()">显示模态框</button>
            <button class="btn" onclick="runDetection()">手动运行检测</button>
            <button class="btn btn-danger" onclick="clearReport()">清除报告</button>
            
            <!-- 下拉菜单测试 -->
            <div class="dropdown">
                <button class="btn">下拉菜单 ▼</button>
                <div class="dropdown-content">
                    <a href="#">选项 1</a>
                    <a href="#">选项 2</a>
                    <a href="#">选项 3</a>
                </div>
            </div>
        </div>
        
        <div class="form-test">
            <h3>表单测试</h3>
            <form>
                <div class="form-group">
                    <label for="testInput">测试输入框：</label>
                    <input type="text" id="testInput" placeholder="请输入文本测试插件是否影响输入">
                </div>
                
                <div class="form-group">
                    <label for="testTextarea">测试文本域：</label>
                    <textarea id="testTextarea" rows="3" placeholder="请输入多行文本测试"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="testSelect">测试选择框：</label>
                    <select id="testSelect">
                        <option value="">请选择选项</option>
                        <option value="1">选项 1</option>
                        <option value="2">选项 2</option>
                        <option value="3">选项 3</option>
                    </select>
                </div>
                
                <button type="submit" class="btn">提交表单</button>
            </form>
        </div>
        
        <div class="link-test">
            <h3>链接测试</h3>
            <p>测试链接是否被插件影响：
                <a href="#link1">链接 1</a>
                <a href="#link2">链接 2</a>
                <a href="#link3">链接 3</a>
                <a href="https://www.example.com" target="_blank" rel="noopener">外部链接</a>
            </p>
        </div>
        
        <div style="margin: 20px 0;">
            <h3>插件功能测试说明</h3>
            <p>请测试以下插件功能，观察是否与页面样式冲突：</p>
            <ul>
                <li>按 "/" 开始搜索功能</li>
                <li>按 ":" 进入命令模式</li>
                <li>按 "f" 进行链接跳转</li>
                <li>使用 "j", "k", "h", "l" 进行页面导航</li>
                <li>观察帮助系统图标是否正常显示</li>
            </ul>
        </div>
        
        <div style="margin: 20px 0;">
            <h3>检测结果说明</h3>
            <p>页面加载后会自动运行样式冲突检测，检测结果将显示在页面左上角。检测内容包括：</p>
            <ul>
                <li>Z-index层级冲突</li>
                <li>定位元素重叠</li>
                <li>重要交互元素遮挡</li>
                <li>字体样式冲突</li>
                <li>颜色对比度问题</li>
            </ul>
        </div>
        
        <div style="height: 500px; background: linear-gradient(45deg, #f0f0f0, #e0e0e0); margin: 20px 0; padding: 20px; border-radius: 8px;">
            <h3>长内容测试区域</h3>
            <p>这是一个较长的内容区域，用于测试页面滚动时插件元素的行为。</p>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
            <p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
            <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.</p>
        </div>
    </div>
    
    <!-- 加载样式冲突检测器 -->
    <script src="style_conflict_detector.js"></script>
    
    <script>
        function showModal() {
            document.getElementById('testModal').style.display = 'flex';
        }
        
        function hideModal() {
            document.getElementById('testModal').style.display = 'none';
        }
        
        function runDetection() {
            if (window.StyleConflictDetector) {
                const detector = new StyleConflictDetector();
                detector.detect();
            } else {
                alert('样式冲突检测器未加载');
            }
        }
        
        function clearReport() {
            const report = document.getElementById('style-conflict-report');
            if (report) {
                report.remove();
            }
        }
        
        // 添加工具提示功能
        document.addEventListener('mouseover', function(e) {
            if (e.target.tagName === 'BUTTON' || e.target.tagName === 'A') {
                const tooltip = document.createElement('div');
                tooltip.className = 'tooltip';
                tooltip.textContent = '这是一个工具提示';
                tooltip.style.left = e.pageX + 10 + 'px';
                tooltip.style.top = e.pageY - 30 + 'px';
                document.body.appendChild(tooltip);
                
                e.target.addEventListener('mouseout', function() {
                    tooltip.remove();
                }, { once: true });
            }
        });
        
        // 阻止表单提交
        document.querySelector('form').addEventListener('submit', function(e) {
            e.preventDefault();
            alert('表单提交已阻止（测试用）');
        });
        
        // ESC键关闭模态框
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                hideModal();
            }
        });
        
        console.log('测试页面已加载，样式冲突检测器将在1秒后自动运行');
    </script>
</body>
</html>