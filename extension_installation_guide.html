<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>rVim æ‰©å±•å®‰è£…å’Œè¯Šæ–­æŒ‡å—</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
        }
        .step {
            background: #ecf0f1;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #3498db;
            border-radius: 5px;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .code {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Monaco', 'Menlo', monospace;
            overflow-x: auto;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover {
            background: #2980b9;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-ok { background-color: #27ae60; }
        .status-error { background-color: #e74c3c; }
        .status-warning { background-color: #f39c12; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ rVim æ‰©å±•å®‰è£…å’Œè¯Šæ–­æŒ‡å—</h1>
        
        <div class="warning">
            <strong>âš ï¸ é‡è¦æç¤ºï¼š</strong> å¦‚æœFé”®åŠŸèƒ½ä¸å·¥ä½œï¼Œå¾ˆå¯èƒ½æ˜¯æ‰©å±•æ²¡æœ‰æ­£ç¡®å®‰è£…æˆ–åŠ è½½ã€‚è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ£€æŸ¥å’Œä¿®å¤ã€‚
        </div>

        <h2>ğŸ“‹ ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥æ‰©å±•çŠ¶æ€</h2>
        <button onclick="checkExtensionStatus()">ğŸ” æ£€æŸ¥æ‰©å±•çŠ¶æ€</button>
        <div id="extensionStatus"></div>

        <h2>ğŸš€ ç¬¬äºŒæ­¥ï¼šå®‰è£… rVim æ‰©å±•</h2>
        
        <div class="step">
            <strong>æ–¹æ³•1ï¼šä»æºç å®‰è£…ï¼ˆæ¨èï¼‰</strong>
            <ol>
                <li>æ‰“å¼€ Chrome æµè§ˆå™¨</li>
                <li>åœ¨åœ°å€æ è¾“å…¥ï¼š<code>chrome://extensions/</code></li>
                <li>å¼€å¯å³ä¸Šè§’çš„ã€Œå¼€å‘è€…æ¨¡å¼ã€</li>
                <li>ç‚¹å‡»ã€ŒåŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åºã€</li>
                <li>é€‰æ‹© rVim é¡¹ç›®æ–‡ä»¶å¤¹ï¼š<code>/Users/robin/Documents/codeforfun/chromium-vim-master</code></li>
                <li>ç¡®è®¤æ‰©å±•å·²åŠ è½½å¹¶å¯ç”¨</li>
            </ol>
        </div>

        <div class="step">
            <strong>æ–¹æ³•2ï¼šæ£€æŸ¥ç°æœ‰å®‰è£…</strong>
            <ol>
                <li>è®¿é—® <code>chrome://extensions/</code></li>
                <li>æŸ¥æ‰¾ "rVim" æ‰©å±•</li>
                <li>ç¡®ä¿æ‰©å±•å·²å¯ç”¨ï¼ˆå¼€å…³ä¸ºè“è‰²ï¼‰</li>
                <li>æ£€æŸ¥æ‰©å±•æƒé™æ˜¯å¦å®Œæ•´</li>
            </ol>
        </div>

        <h2>ğŸ”§ ç¬¬ä¸‰æ­¥ï¼šéªŒè¯æ‰©å±•åŠŸèƒ½</h2>
        <button onclick="testBasicFunctionality()">ğŸ§ª æµ‹è¯•åŸºæœ¬åŠŸèƒ½</button>
        <button onclick="testFKeyFunction()">âŒ¨ï¸ æµ‹è¯•Fé”®åŠŸèƒ½</button>
        <button onclick="testContentScripts()">ğŸ“œ æµ‹è¯•Content Scripts</button>
        
        <div id="testResults"></div>

        <h2>ğŸ› ï¸ ç¬¬å››æ­¥ï¼šå¸¸è§é—®é¢˜è§£å†³</h2>
        
        <div class="step">
            <strong>é—®é¢˜1ï¼šæ‰©å±•æœªæ˜¾ç¤ºåœ¨æ‰©å±•åˆ—è¡¨ä¸­</strong>
            <ul>
                <li>ç¡®è®¤å·²æ­£ç¡®é€‰æ‹©é¡¹ç›®æ ¹ç›®å½•</li>
                <li>æ£€æŸ¥ manifest.json æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®</li>
                <li>é‡æ–°åŠ è½½æ‰©å±•</li>
            </ul>
        </div>

        <div class="step">
            <strong>é—®é¢˜2ï¼šæ‰©å±•å·²å®‰è£…ä½†Fé”®ä¸å·¥ä½œ</strong>
            <ul>
                <li>åˆ·æ–°å½“å‰é¡µé¢ï¼ˆCtrl+R æˆ– Cmd+Rï¼‰</li>
                <li>æ£€æŸ¥é¡µé¢æ˜¯å¦åœ¨æ‰©å±•æƒé™èŒƒå›´å†…</li>
                <li>æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯</li>
            </ul>
        </div>

        <div class="step">
            <strong>é—®é¢˜3ï¼šContent Scripts æœªåŠ è½½</strong>
            <ul>
                <li>æ£€æŸ¥æ‰©å±•æƒé™è®¾ç½®</li>
                <li>ç¡®è®¤ manifest.json ä¸­çš„ content_scripts é…ç½®</li>
                <li>é‡å¯æµè§ˆå™¨</li>
            </ul>
        </div>

        <h2>ğŸ“Š ç¬¬äº”æ­¥ï¼šè¯¦ç»†è¯Šæ–­</h2>
        <button onclick="runComprehensiveDiagnosis()">ğŸ”¬ è¿è¡Œå®Œæ•´è¯Šæ–­</button>
        <div id="diagnosisResults"></div>

        <div class="code" id="installationCommands" style="display: none;">
            <h3>ğŸ“‹ å®‰è£…å‘½ä»¤ï¼ˆå¦‚éœ€è¦ï¼‰</h3>
            <div>1. æ‰“å¼€ç»ˆç«¯</div>
            <div>2. è¿›å…¥é¡¹ç›®ç›®å½•ï¼šcd /Users/robin/Documents/codeforfun/chromium-vim-master</div>
            <div>3. æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§ï¼šls -la manifest.json content_scripts/</div>
            <div>4. åœ¨Chromeä¸­åŠ è½½æ‰©å±•</div>
        </div>
    </div>

    <script>
        function checkExtensionStatus() {
            const statusDiv = document.getElementById('extensionStatus');
            let html = '<h3>ğŸ” æ‰©å±•çŠ¶æ€æ£€æŸ¥ç»“æœ</h3>';
            
            // æ£€æŸ¥å„ç§æ‰©å±•å¯¹è±¡
            const checks = [
                { name: 'Hints', obj: window.Hints },
                { name: 'HUD', obj: window.HUD },
                { name: 'Settings', obj: window.Settings },
                { name: 'Command', obj: window.Command },
                { name: 'Mappings', obj: window.Mappings },
                { name: 'DOM', obj: window.DOM },
                { name: 'Utils', obj: window.Utils }
            ];
            
            checks.forEach(check => {
                const status = check.obj ? 'ok' : 'error';
                const statusText = check.obj ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½';
                html += `<div class="test-result ${status === 'ok' ? 'success' : 'error'}">`;
                html += `<span class="status-indicator status-${status}"></span>`;
                html += `${check.name}: ${statusText}`;
                html += '</div>';
            });
            
            // æ£€æŸ¥CSSæ³¨å…¥
            const cssInjected = document.querySelector('style[data-rvim]') || 
                               document.querySelector('link[href*="main.css"]');
            const cssStatus = cssInjected ? 'ok' : 'warning';
            const cssText = cssInjected ? 'âœ… CSSå·²æ³¨å…¥' : 'âš ï¸ CSSæœªæ£€æµ‹åˆ°';
            html += `<div class="test-result ${cssStatus === 'ok' ? 'success' : 'warning'}">`;
            html += `<span class="status-indicator status-${cssStatus}"></span>`;
            html += `CSSæ ·å¼: ${cssText}`;
            html += '</div>';
            
            statusDiv.innerHTML = html;
        }
        
        function testBasicFunctionality() {
            const resultsDiv = document.getElementById('testResults');
            let html = '<h3>ğŸ§ª åŸºæœ¬åŠŸèƒ½æµ‹è¯•ç»“æœ</h3>';
            
            // æµ‹è¯•æ‰©å±•ä¸Šä¸‹æ–‡
            try {
                const hasExtensionContext = typeof chrome !== 'undefined' && chrome.runtime;
                html += `<div class="test-result ${hasExtensionContext ? 'success' : 'error'}">`;
                html += `æ‰©å±•ä¸Šä¸‹æ–‡: ${hasExtensionContext ? 'âœ… å¯ç”¨' : 'âŒ ä¸å¯ç”¨'}`;
                html += '</div>';
            } catch (e) {
                html += '<div class="test-result error">æ‰©å±•ä¸Šä¸‹æ–‡: âŒ æ£€æµ‹å¤±è´¥</div>';
            }
            
            // æµ‹è¯•DOMæ“ä½œ
            try {
                const testDiv = document.createElement('div');
                testDiv.style.display = 'none';
                document.body.appendChild(testDiv);
                document.body.removeChild(testDiv);
                html += '<div class="test-result success">DOMæ“ä½œ: âœ… æ­£å¸¸</div>';
            } catch (e) {
                html += '<div class="test-result error">DOMæ“ä½œ: âŒ å¤±è´¥</div>';
            }
            
            resultsDiv.innerHTML = html;
        }
        
        function testFKeyFunction() {
            const resultsDiv = document.getElementById('testResults');
            let html = resultsDiv.innerHTML + '<h3>âŒ¨ï¸ Fé”®åŠŸèƒ½æµ‹è¯•</h3>';
            
            if (typeof window.Hints !== 'undefined') {
                html += '<div class="test-result success">Hintså¯¹è±¡: âœ… å¯ç”¨</div>';
                
                if (typeof window.Hints.create === 'function') {
                    html += '<div class="test-result success">Hints.createå‡½æ•°: âœ… å¯ç”¨</div>';
                    
                    // å°è¯•è°ƒç”¨Hints.create
                    try {
                        // åˆ›å»ºæµ‹è¯•é“¾æ¥
                        const testLink = document.createElement('a');
                        testLink.href = '#test';
                        testLink.textContent = 'æµ‹è¯•é“¾æ¥';
                        testLink.style.display = 'none';
                        document.body.appendChild(testLink);
                        
                        // è°ƒç”¨Hints.create
                        window.Hints.create();
                        html += '<div class="test-result success">Fé”®åŠŸèƒ½è°ƒç”¨: âœ… æˆåŠŸ</div>';
                        
                        // æ¸…ç†
                        document.body.removeChild(testLink);
                    } catch (e) {
                        html += `<div class="test-result error">Fé”®åŠŸèƒ½è°ƒç”¨: âŒ å¤±è´¥ - ${e.message}</div>`;
                    }
                } else {
                    html += '<div class="test-result error">Hints.createå‡½æ•°: âŒ ä¸å¯ç”¨</div>';
                }
            } else {
                html += '<div class="test-result error">Hintså¯¹è±¡: âŒ ä¸å¯ç”¨</div>';
            }
            
            resultsDiv.innerHTML = html;
        }
        
        function testContentScripts() {
            const resultsDiv = document.getElementById('testResults');
            let html = resultsDiv.innerHTML + '<h3>ğŸ“œ Content Scriptsæµ‹è¯•</h3>';
            
            const scripts = [
                'hints.js', 'mappings.js', 'command.js', 'hud.js', 
                'utils.js', 'dom.js', 'keys.js'
            ];
            
            scripts.forEach(script => {
                const scriptName = script.replace('.js', '');
                const globalName = scriptName.charAt(0).toUpperCase() + scriptName.slice(1);
                const isLoaded = typeof window[globalName] !== 'undefined';
                
                html += `<div class="test-result ${isLoaded ? 'success' : 'error'}">`;
                html += `${script}: ${isLoaded ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½'}`;
                html += '</div>';
            });
            
            resultsDiv.innerHTML = html;
        }
        
        function runComprehensiveDiagnosis() {
            const diagnosisDiv = document.getElementById('diagnosisResults');
            let html = '<h3>ğŸ”¬ å®Œæ•´è¯Šæ–­ç»“æœ</h3>';
            
            // æ£€æŸ¥æµè§ˆå™¨ä¿¡æ¯
            html += `<div class="test-result success">æµè§ˆå™¨: ${navigator.userAgent.includes('Chrome') ? 'âœ… Chrome' : 'âš ï¸ å…¶ä»–æµè§ˆå™¨'}</div>`;
            
            // æ£€æŸ¥é¡µé¢åè®®
            const isHttps = location.protocol === 'https:' || location.protocol === 'http:';
            html += `<div class="test-result ${isHttps ? 'success' : 'warning'}">é¡µé¢åè®®: ${location.protocol} ${isHttps ? 'âœ… æ”¯æŒ' : 'âš ï¸ å¯èƒ½ä¸æ”¯æŒ'}</div>`;
            
            // æ£€æŸ¥æ§åˆ¶å°é”™è¯¯
            html += '<div class="test-result warning">ğŸ’¡ è¯·æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°(F12)æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯</div>';
            
            // æ˜¾ç¤ºå®‰è£…å‘½ä»¤
            document.getElementById('installationCommands').style.display = 'block';
            
            diagnosisDiv.innerHTML = html;
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', function() {
            setTimeout(checkExtensionStatus, 1000);
        });
    </script>
</body>
</html>