<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>rVimæ‰©å±•çŠ¶æ€æ£€æŸ¥å™¨</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .status-item {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #ddd;
        }
        .status-success {
            background-color: #d4edda;
            border-left-color: #28a745;
            color: #155724;
        }
        .status-error {
            background-color: #f8d7da;
            border-left-color: #dc3545;
            color: #721c24;
        }
        .status-warning {
            background-color: #fff3cd;
            border-left-color: #ffc107;
            color: #856404;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .code-block {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
            white-space: pre-wrap;
            margin: 10px 0;
        }
        .instruction {
            background-color: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” rVimæ‰©å±•çŠ¶æ€æ£€æŸ¥å™¨</h1>
        <p>æ­¤é¡µé¢å¸®åŠ©è¯Šæ–­rVimæ‰©å±•çš„å®‰è£…å’Œè¿è¡ŒçŠ¶æ€</p>
        
        <button onclick="checkExtensionStatus()">ğŸ”„ æ£€æŸ¥æ‰©å±•çŠ¶æ€</button>
        <button onclick="testFFunction()">ğŸ”— æµ‹è¯•FåŠŸèƒ½</button>
        <button onclick="checkConsoleErrors()">âš ï¸ æ£€æŸ¥æ§åˆ¶å°é”™è¯¯</button>
    </div>

    <div class="container">
        <h2>ğŸ“‹ æ£€æŸ¥ç»“æœ</h2>
        <div id="results"></div>
    </div>

    <div class="container">
        <h2>ğŸ› ï¸ å®‰è£…æŒ‡å—</h2>
        <div class="instruction">
            <h3>å¦‚æœæ‰©å±•æœªæ­£ç¡®å®‰è£…ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š</h3>
            <ol>
                <li><strong>æ‰“å¼€Chromeæ‰©å±•ç®¡ç†é¡µé¢ï¼š</strong>
                    <div class="code-block">chrome://extensions/</div>
                </li>
                <li><strong>å¯ç”¨å¼€å‘è€…æ¨¡å¼ï¼š</strong>ç‚¹å‡»å³ä¸Šè§’çš„"å¼€å‘è€…æ¨¡å¼"å¼€å…³</li>
                <li><strong>åŠ è½½æœªæ‰“åŒ…çš„æ‰©å±•ï¼š</strong>ç‚¹å‡»"åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº"</li>
                <li><strong>é€‰æ‹©æ‰©å±•ç›®å½•ï¼š</strong>é€‰æ‹©chromium-vim-masteræ–‡ä»¶å¤¹</li>
                <li><strong>ç¡®è®¤æ‰©å±•å·²å¯ç”¨ï¼š</strong>ç¡®ä¿æ‰©å±•å¡ç‰‡ä¸Šçš„å¼€å…³æ˜¯æ‰“å¼€çŠ¶æ€</li>
            </ol>
        </div>
        
        <div class="instruction">
            <h3>å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆï¼š</h3>
            <ul>
                <li><strong>æ‰©å±•å›¾æ ‡æ˜¾ç¤ºä¸ºç°è‰²ï¼š</strong>æ‰©å±•å¯èƒ½è¢«ç¦ç”¨ï¼Œç‚¹å‡»å›¾æ ‡æˆ–åœ¨æ‰©å±•ç®¡ç†é¡µé¢å¯ç”¨</li>
                <li><strong>Fé”®æ— å“åº”ï¼š</strong>ç¡®ä¿å½“å‰é¡µé¢ä¸åœ¨æ‰©å±•é»‘åå•ä¸­</li>
                <li><strong>æ§åˆ¶å°æœ‰é”™è¯¯ï¼š</strong>å¯èƒ½æ˜¯manifestç‰ˆæœ¬æˆ–æƒé™é—®é¢˜ï¼Œéœ€è¦æ›´æ–°é…ç½®</li>
            </ul>
        </div>
    </div>

    <div class="container">
        <h2>ğŸ§ª æµ‹è¯•é“¾æ¥</h2>
        <p>ä½¿ç”¨ä»¥ä¸‹é“¾æ¥æµ‹è¯•FåŠŸèƒ½ï¼š</p>
        <a href="https://www.google.com" target="_blank" rel="noopener">Google</a> |
        <a href="https://www.github.com" target="_blank" rel="noopener">GitHub</a> |
        <a href="#test1">å†…éƒ¨é“¾æ¥1</a> |
        <a href="#test2">å†…éƒ¨é“¾æ¥2</a>
        <br><br>
        <button onclick="window.open('https://www.example.com')">æŒ‰é’®é“¾æ¥</button>
    </div>

    <script>
        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `status-item status-${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        function checkExtensionStatus() {
            clearResults();
            addResult('ğŸ” å¼€å§‹æ£€æŸ¥æ‰©å±•çŠ¶æ€...', 'warning');
            
            // æ£€æŸ¥å…¨å±€å¯¹è±¡
            const checks = [
                { name: 'Commandå¯¹è±¡', obj: 'Command', desc: 'rVimå‘½ä»¤å¤„ç†å™¨' },
                { name: 'Hintså¯¹è±¡', obj: 'Hints', desc: 'é“¾æ¥æç¤ºåŠŸèƒ½' },
                { name: 'Mappingså¯¹è±¡', obj: 'Mappings', desc: 'é”®ç›˜æ˜ å°„' },
                { name: 'settingså¯¹è±¡', obj: 'settings', desc: 'æ‰©å±•è®¾ç½®' },
                { name: 'DOMå¯¹è±¡', obj: 'DOM', desc: 'DOMæ“ä½œå·¥å…·' },
                { name: 'Utilså¯¹è±¡', obj: 'Utils', desc: 'å·¥å…·å‡½æ•°' }
            ];

            let successCount = 0;
            checks.forEach(check => {
                try {
                    if (typeof window[check.obj] !== 'undefined') {
                        addResult(`âœ… ${check.name}: å·²åŠ è½½ (${check.desc})`, 'success');
                        successCount++;
                    } else {
                        addResult(`âŒ ${check.name}: æœªæ‰¾åˆ° (${check.desc})`, 'error');
                    }
                } catch (e) {
                    addResult(`âŒ ${check.name}: æ£€æŸ¥å¤±è´¥ - ${e.message}`, 'error');
                }
            });

            // æ£€æŸ¥CSS
            const linkHintStyle = document.querySelector('style[data-rvim], link[href*="main.css"]');
            if (linkHintStyle) {
                addResult('âœ… rVimæ ·å¼: å·²åŠ è½½', 'success');
                successCount++;
            } else {
                addResult('âŒ rVimæ ·å¼: æœªæ‰¾åˆ°', 'error');
            }

            // æ€»ç»“
            if (successCount >= 4) {
                addResult(`ğŸ‰ æ‰©å±•çŠ¶æ€è‰¯å¥½ (${successCount}/${checks.length + 1} é¡¹é€šè¿‡)`, 'success');
            } else if (successCount >= 2) {
                addResult(`âš ï¸ æ‰©å±•éƒ¨åˆ†åŠ è½½ (${successCount}/${checks.length + 1} é¡¹é€šè¿‡)`, 'warning');
            } else {
                addResult(`ğŸš¨ æ‰©å±•æœªæ­£ç¡®åŠ è½½ (${successCount}/${checks.length + 1} é¡¹é€šè¿‡)`, 'error');
                addResult('ğŸ’¡ å»ºè®®ï¼šæ£€æŸ¥æ‰©å±•æ˜¯å¦å·²å®‰è£…å¹¶å¯ç”¨', 'warning');
            }
        }

        function testFFunction() {
            addResult('ğŸ”— æµ‹è¯•FåŠŸèƒ½...', 'warning');
            
            if (typeof Hints === 'undefined') {
                addResult('âŒ FåŠŸèƒ½æµ‹è¯•å¤±è´¥: Hintså¯¹è±¡ä¸å­˜åœ¨', 'error');
                return;
            }

            try {
                // æ¨¡æ‹ŸFé”®æŒ‰ä¸‹
                if (typeof Hints.create === 'function') {
                    addResult('âœ… Hints.createå‡½æ•°å­˜åœ¨', 'success');
                    
                    // æ£€æŸ¥é“¾æ¥æ•°é‡
                    const links = document.querySelectorAll('a, button, [onclick], [role="button"]');
                    addResult(`ğŸ”— é¡µé¢é“¾æ¥æ•°é‡: ${links.length}`, 'info');
                    
                    if (links.length > 0) {
                        addResult('ğŸ’¡ è¯·æ‰‹åŠ¨æŒ‰Fé”®æµ‹è¯•é“¾æ¥æç¤ºåŠŸèƒ½', 'warning');
                    } else {
                        addResult('âš ï¸ é¡µé¢æ²¡æœ‰å¯ç‚¹å‡»çš„é“¾æ¥å…ƒç´ ', 'warning');
                    }
                } else {
                    addResult('âŒ Hints.createå‡½æ•°ä¸å­˜åœ¨', 'error');
                }
            } catch (e) {
                addResult(`âŒ FåŠŸèƒ½æµ‹è¯•å‡ºé”™: ${e.message}`, 'error');
            }
        }

        function checkConsoleErrors() {
            addResult('âš ï¸ æ£€æŸ¥æ§åˆ¶å°é”™è¯¯...', 'warning');
            addResult('ğŸ’¡ è¯·æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12) æŸ¥çœ‹Consoleæ ‡ç­¾é¡µ', 'info');
            addResult('ğŸ” æŸ¥æ‰¾ä»¥ä¸‹ç±»å‹çš„é”™è¯¯:', 'info');
            addResult('â€¢ è„šæœ¬åŠ è½½å¤±è´¥ (Failed to load script)', 'info');
            addResult('â€¢ æƒé™é”™è¯¯ (Permission denied)', 'info');
            addResult('â€¢ æœªå®šä¹‰çš„å˜é‡ (ReferenceError)', 'info');
            addResult('â€¢ ç½‘ç»œé”™è¯¯ (Network error)', 'info');
            
            // å°è¯•æ•è·ä¸€äº›å¸¸è§é”™è¯¯
            const commonErrors = [];
            
            // æ£€æŸ¥æ˜¯å¦æœ‰è„šæœ¬åŠ è½½å¤±è´¥
            const scripts = document.querySelectorAll('script[src]');
            scripts.forEach(script => {
                if (script.src.includes('content_scripts') && !script.complete) {
                    commonErrors.push(`è„šæœ¬å¯èƒ½æœªåŠ è½½: ${script.src}`);
                }
            });
            
            if (commonErrors.length > 0) {
                commonErrors.forEach(error => addResult(`âš ï¸ ${error}`, 'warning'));
            } else {
                addResult('âœ… æœªå‘ç°æ˜æ˜¾çš„è„šæœ¬åŠ è½½é—®é¢˜', 'success');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', function() {
            setTimeout(checkExtensionStatus, 1000);
        });

        // ç›‘å¬é”®ç›˜äº‹ä»¶
        document.addEventListener('keydown', function(e) {
            if (e.key === 'f' || e.key === 'F') {
                setTimeout(() => {
                    const hintContainer = document.querySelector('#Vim-link-container, .rVim-link-hint');
                    if (hintContainer) {
                        addResult('âœ… Fé”®å“åº”: æ£€æµ‹åˆ°é“¾æ¥æç¤ºå®¹å™¨', 'success');
                    } else {
                        addResult('âŒ Fé”®æ— å“åº”: æœªæ£€æµ‹åˆ°é“¾æ¥æç¤º', 'error');
                    }
                }, 100);
            }
        });
    </script>
</body>
</html>