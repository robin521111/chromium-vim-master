<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>rVim è§†è§‰æ¨¡å¼å’Œæ–‡æœ¬é€‰æ‹©åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        .content {
            padding: 40px;
        }
        .test-section {
            margin: 30px 0;
            padding: 25px;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            background: #f8f9fa;
        }
        .test-section h2 {
            color: #2c3e50;
            margin-top: 0;
            display: flex;
            align-items: center;
        }
        .test-section h2::before {
            content: 'ğŸ‘ï¸';
            margin-right: 10px;
            font-size: 1.2em;
        }
        .test-item {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #e74c3c;
        }
        .shortcut {
            background: #34495e;
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
        .status {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin-left: 10px;
        }
        .status.pending { background: #f39c12; color: white; }
        .status.testing { background: #3498db; color: white; }
        .status.passed { background: #27ae60; color: white; }
        .status.failed { background: #e74c3c; color: white; }
        .instructions {
            background: #e8f5e8;
            border: 1px solid #27ae60;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            color: #856404;
        }
        .control-panel {
            background: #ffeaa7;
            border: 2px solid #fdcb6e;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        button {
            margin: 5px;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-primary { background: #3498db; color: white; }
        .btn-success { background: #27ae60; color: white; }
        .btn-warning { background: #f39c12; color: white; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn-red { background: #e74c3c; color: white; }
        .text-sample {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            font-family: 'Georgia', serif;
            line-height: 1.8;
            -webkit-user-select: text;
            user-select: text;
        }
        .text-sample h3 {
            margin-top: 0;
            color: #e74c3c;
        }
        .text-sample p {
            margin: 15px 0;
        }
        .code-sample {
            background: #2c3e50;
            color: #ecf0f1;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
            -webkit-user-select: text;
            user-select: text;
        }
        .selection-indicator {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        .visual-mode-demo {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
        .keyboard-shortcuts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .shortcut-card {
            background: white;
            border: 2px solid #e74c3c;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        .shortcut-card .key {
            background: #e74c3c;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            display: inline-block;
            margin: 5px;
        }
        .shortcut-card .desc {
            margin-top: 10px;
            font-size: 0.9em;
            color: #666;
        }
        .test-results {
            background: #f1f2f6;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ‘ï¸ rVim è§†è§‰æ¨¡å¼å’Œæ–‡æœ¬é€‰æ‹©åŠŸèƒ½æµ‹è¯•</h1>
            <p>æµ‹è¯•è§†è§‰æ¨¡å¼ã€æ–‡æœ¬é€‰æ‹©ã€å¤åˆ¶ç²˜è´´ç­‰åŠŸèƒ½</p>
            <div id="extension-status" class="status pending">ğŸ”„ æ£€æŸ¥æ‰©å±•çŠ¶æ€ä¸­...</div>
        </div>
        
        <div class="content">
            <div class="instructions">
                <h3>ğŸ“‹ è§†è§‰æ¨¡å¼æµ‹è¯•è¯´æ˜</h3>
                <p>æœ¬é¡µé¢ç”¨äºæµ‹è¯• rVim çš„è§†è§‰æ¨¡å¼å’Œæ–‡æœ¬é€‰æ‹©åŠŸèƒ½ï¼š</p>
                <ol>
                    <li>ç¡®ä¿ rVim æ‰©å±•å·²å®‰è£…å¹¶å¯ç”¨</li>
                    <li>æµ‹è¯•è¿›å…¥å’Œé€€å‡ºè§†è§‰æ¨¡å¼</li>
                    <li>æµ‹è¯•æ–‡æœ¬é€‰æ‹©å’Œé«˜äº®æ˜¾ç¤º</li>
                    <li>æµ‹è¯•å¤åˆ¶ã€ç²˜è´´å’Œåˆ é™¤æ“ä½œ</li>
                    <li>æµ‹è¯•ä¸åŒç±»å‹çš„è§†è§‰æ¨¡å¼ï¼ˆå­—ç¬¦ã€è¡Œã€å—ï¼‰</li>
                </ol>
            </div>

            <div class="visual-mode-demo">
                <h2>ğŸ¯ è§†è§‰æ¨¡å¼å¿«é€Ÿæ¼”ç¤º</h2>
                <p>æŒ‰ <strong>v</strong> è¿›å…¥å­—ç¬¦è§†è§‰æ¨¡å¼ï¼ŒæŒ‰ <strong>V</strong> è¿›å…¥è¡Œè§†è§‰æ¨¡å¼ï¼ŒæŒ‰ <strong>Ctrl+v</strong> è¿›å…¥å—è§†è§‰æ¨¡å¼</p>
                <p>ä½¿ç”¨ <strong>hjkl</strong> æˆ–æ–¹å‘é”®ç§»åŠ¨å…‰æ ‡æ¥é€‰æ‹©æ–‡æœ¬ï¼ŒæŒ‰ <strong>y</strong> å¤åˆ¶ï¼ŒæŒ‰ <strong>d</strong> åˆ é™¤</p>
            </div>

            <div class="control-panel">
                <h3>ğŸ® æµ‹è¯•æ§åˆ¶é¢æ¿</h3>
                <p>
                    <button class="btn-red" onclick="startVisualModeTest()">ğŸ‘ï¸ å¼€å§‹è§†è§‰æ¨¡å¼æµ‹è¯•</button>
                    <button class="btn-primary" onclick="startTextSelectionTest()">ğŸ“ å¼€å§‹æ–‡æœ¬é€‰æ‹©æµ‹è¯•</button>
                    <button class="btn-success" onclick="checkVisualModeResults()">ğŸ“Š æŸ¥çœ‹æµ‹è¯•ç»“æœ</button>
                    <button class="btn-warning" onclick="exportVisualModeResults()">ğŸ’¾ å¯¼å‡ºæµ‹è¯•ç»“æœ</button>
                </p>
                <p><strong>æç¤ºï¼š</strong> æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†çš„æµ‹è¯•æ—¥å¿—</p>
            </div>

            <div class="keyboard-shortcuts">
                <div class="shortcut-card">
                    <div class="key">v</div>
                    <div class="desc">è¿›å…¥å­—ç¬¦è§†è§‰æ¨¡å¼</div>
                </div>
                <div class="shortcut-card">
                    <div class="key">V</div>
                    <div class="desc">è¿›å…¥è¡Œè§†è§‰æ¨¡å¼</div>
                </div>
                <div class="shortcut-card">
                    <div class="key">Ctrl+v</div>
                    <div class="desc">è¿›å…¥å—è§†è§‰æ¨¡å¼</div>
                </div>
                <div class="shortcut-card">
                    <div class="key">y</div>
                    <div class="desc">å¤åˆ¶é€‰ä¸­æ–‡æœ¬</div>
                </div>
                <div class="shortcut-card">
                    <div class="key">d</div>
                    <div class="desc">åˆ é™¤é€‰ä¸­æ–‡æœ¬</div>
                </div>
                <div class="shortcut-card">
                    <div class="key">p</div>
                    <div class="desc">ç²˜è´´æ–‡æœ¬</div>
                </div>
                <div class="shortcut-card">
                    <div class="key">Esc</div>
                    <div class="desc">é€€å‡ºè§†è§‰æ¨¡å¼</div>
                </div>
                <div class="shortcut-card">
                    <div class="key">o</div>
                    <div class="desc">åˆ‡æ¢é€‰æ‹©æ–¹å‘</div>
                </div>
            </div>

            <div class="test-section">
                <h2>å­—ç¬¦è§†è§‰æ¨¡å¼æµ‹è¯•</h2>
                
                <div class="test-item">
                    <h3>è¿›å…¥å­—ç¬¦è§†è§‰æ¨¡å¼ <span class="status pending">å¾…æµ‹è¯•</span></h3>
                    <p><strong>æµ‹è¯•æ­¥éª¤ï¼š</strong> æŒ‰ <span class="shortcut">v</span> é”®</p>
                    <p><strong>é¢„æœŸç»“æœï¼š</strong> è¿›å…¥å­—ç¬¦è§†è§‰æ¨¡å¼ï¼Œå…‰æ ‡ä½ç½®å¼€å§‹é€‰æ‹©</p>
                </div>
                
                <div class="test-item">
                    <h3>å­—ç¬¦é€‰æ‹©ç§»åŠ¨ <span class="status pending">å¾…æµ‹è¯•</span></h3>
                    <p><strong>æµ‹è¯•æ­¥éª¤ï¼š</strong> åœ¨è§†è§‰æ¨¡å¼ä¸‹ä½¿ç”¨ <span class="shortcut">hjkl</span> ç§»åŠ¨</p>
                    <p><strong>é¢„æœŸç»“æœï¼š</strong> æ–‡æœ¬è¢«é€å­—ç¬¦é€‰ä¸­å¹¶é«˜äº®æ˜¾ç¤º</p>
                </div>
                
                <div class="test-item">
                    <h3>å¤åˆ¶é€‰ä¸­æ–‡æœ¬ <span class="status pending">å¾…æµ‹è¯•</span></h3>
                    <p><strong>æµ‹è¯•æ­¥éª¤ï¼š</strong> é€‰ä¸­æ–‡æœ¬åæŒ‰ <span class="shortcut">y</span></p>
                    <p><strong>é¢„æœŸç»“æœï¼š</strong> æ–‡æœ¬è¢«å¤åˆ¶ï¼Œé€€å‡ºè§†è§‰æ¨¡å¼</p>
                </div>
                
                <div class="text-sample">
                    <h3>å­—ç¬¦é€‰æ‹©æµ‹è¯•æ–‡æœ¬</h3>
                    <p>è¿™æ˜¯ä¸€æ®µç”¨äºæµ‹è¯•å­—ç¬¦è§†è§‰æ¨¡å¼çš„æ–‡æœ¬ã€‚è¯·å°è¯•é€‰æ‹©è¿™æ®µæ–‡å­—ä¸­çš„ä»»æ„éƒ¨åˆ†ï¼Œæ¯”å¦‚é€‰æ‹©"å­—ç¬¦è§†è§‰æ¨¡å¼"è¿™å‡ ä¸ªå­—ã€‚</p>
                    <p>ä½ å¯ä»¥ä½¿ç”¨ v é”®è¿›å…¥å­—ç¬¦è§†è§‰æ¨¡å¼ï¼Œç„¶åç”¨ hjkl é”®ç§»åŠ¨å…‰æ ‡æ¥é€‰æ‹©æ–‡æœ¬ã€‚é€‰æ‹©å®Œæˆåï¼ŒæŒ‰ y é”®å¤åˆ¶ï¼Œæˆ–æŒ‰ d é”®åˆ é™¤ã€‚</p>
                </div>
            </div>

            <div class="test-section">
                <h2>è¡Œè§†è§‰æ¨¡å¼æµ‹è¯•</h2>
                
                <div class="test-item">
                    <h3>è¿›å…¥è¡Œè§†è§‰æ¨¡å¼ <span class="status pending">å¾…æµ‹è¯•</span></h3>
                    <p><strong>æµ‹è¯•æ­¥éª¤ï¼š</strong> æŒ‰ <span class="shortcut">V</span> é”®ï¼ˆShift+vï¼‰</p>
                    <p><strong>é¢„æœŸç»“æœï¼š</strong> è¿›å…¥è¡Œè§†è§‰æ¨¡å¼ï¼Œæ•´è¡Œè¢«é€‰ä¸­</p>
                </div>
                
                <div class="test-item">
                    <h3>å¤šè¡Œé€‰æ‹© <span class="status pending">å¾…æµ‹è¯•</span></h3>
                    <p><strong>æµ‹è¯•æ­¥éª¤ï¼š</strong> åœ¨è¡Œè§†è§‰æ¨¡å¼ä¸‹ä½¿ç”¨ <span class="shortcut">jk</span> ç§»åŠ¨</p>
                    <p><strong>é¢„æœŸç»“æœï¼š</strong> å¤šè¡Œæ–‡æœ¬è¢«é€‰ä¸­å¹¶é«˜äº®æ˜¾ç¤º</p>
                </div>
                
                <div class="test-item">
                    <h3>è¡Œå¤åˆ¶å’Œåˆ é™¤ <span class="status pending">å¾…æµ‹è¯•</span></h3>
                    <p><strong>æµ‹è¯•æ­¥éª¤ï¼š</strong> é€‰ä¸­è¡ŒåæŒ‰ <span class="shortcut">y</span> æˆ– <span class="shortcut">d</span></p>
                    <p><strong>é¢„æœŸç»“æœï¼š</strong> æ•´è¡Œè¢«å¤åˆ¶æˆ–åˆ é™¤</p>
                </div>
                
                <div class="text-sample">
                    <h3>è¡Œé€‰æ‹©æµ‹è¯•æ–‡æœ¬</h3>
                    <p>ç¬¬ä¸€è¡Œï¼šè¿™æ˜¯ç”¨äºæµ‹è¯•è¡Œè§†è§‰æ¨¡å¼çš„ç¬¬ä¸€è¡Œæ–‡æœ¬ã€‚</p>
                    <p>ç¬¬äºŒè¡Œï¼šè¯·å°è¯•é€‰æ‹©è¿™ä¸€è¡Œæˆ–å¤šè¡Œæ–‡æœ¬ã€‚</p>
                    <p>ç¬¬ä¸‰è¡Œï¼šä½¿ç”¨ V é”®è¿›å…¥è¡Œè§†è§‰æ¨¡å¼ã€‚</p>
                    <p>ç¬¬å››è¡Œï¼šç„¶åç”¨ j å’Œ k é”®é€‰æ‹©å¤šè¡Œã€‚</p>
                    <p>ç¬¬äº”è¡Œï¼šæœ€åæŒ‰ y å¤åˆ¶æˆ– d åˆ é™¤é€‰ä¸­çš„è¡Œã€‚</p>
                </div>
            </div>

            <div class="test-section">
                <h2>å—è§†è§‰æ¨¡å¼æµ‹è¯•</h2>
                
                <div class="test-item">
                    <h3>è¿›å…¥å—è§†è§‰æ¨¡å¼ <span class="status pending">å¾…æµ‹è¯•</span></h3>
                    <p><strong>æµ‹è¯•æ­¥éª¤ï¼š</strong> æŒ‰ <span class="shortcut">Ctrl+v</span></p>
                    <p><strong>é¢„æœŸç»“æœï¼š</strong> è¿›å…¥å—è§†è§‰æ¨¡å¼ï¼Œå¯ä»¥é€‰æ‹©çŸ©å½¢åŒºåŸŸ</p>
                </div>
                
                <div class="test-item">
                    <h3>çŸ©å½¢åŒºåŸŸé€‰æ‹© <span class="status pending">å¾…æµ‹è¯•</span></h3>
                    <p><strong>æµ‹è¯•æ­¥éª¤ï¼š</strong> åœ¨å—è§†è§‰æ¨¡å¼ä¸‹ç§»åŠ¨å…‰æ ‡</p>
                    <p><strong>é¢„æœŸç»“æœï¼š</strong> é€‰æ‹©çŸ©å½¢åŒºåŸŸçš„æ–‡æœ¬</p>
                </div>
                
                <div class="code-sample">
                    <h3>å—é€‰æ‹©æµ‹è¯•ä»£ç </h3>
                    <pre>function testBlockSelection() {
    const line1 = "ç¬¬ä¸€è¡Œä»£ç ";
    const line2 = "ç¬¬äºŒè¡Œä»£ç ";
    const line3 = "ç¬¬ä¸‰è¡Œä»£ç ";
    const line4 = "ç¬¬å››è¡Œä»£ç ";
    return "æµ‹è¯•å®Œæˆ";
}</pre>
                    <p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå°è¯•ä½¿ç”¨ Ctrl+v è¿›å…¥å—è§†è§‰æ¨¡å¼ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªçŸ©å½¢åŒºåŸŸï¼Œæ¯”å¦‚æ‰€æœ‰çš„ "const" å…³é”®å­—ã€‚</p>
                </div>
            </div>

            <div class="test-section">
                <h2>æ–‡æœ¬æ“ä½œæµ‹è¯•</h2>
                
                <div class="test-item">
                    <h3>å¤åˆ¶ç²˜è´´æ“ä½œ <span class="status pending">å¾…æµ‹è¯•</span></h3>
                    <p><strong>æµ‹è¯•æ­¥éª¤ï¼š</strong> é€‰ä¸­æ–‡æœ¬ï¼ŒæŒ‰ <span class="shortcut">y</span> å¤åˆ¶ï¼Œç§»åŠ¨å…‰æ ‡ï¼ŒæŒ‰ <span class="shortcut">p</span> ç²˜è´´</p>
                    <p><strong>é¢„æœŸç»“æœï¼š</strong> æ–‡æœ¬è¢«æ­£ç¡®å¤åˆ¶å’Œç²˜è´´</p>
                </div>
                
                <div class="test-item">
                    <h3>åˆ é™¤æ“ä½œ <span class="status pending">å¾…æµ‹è¯•</span></h3>
                    <p><strong>æµ‹è¯•æ­¥éª¤ï¼š</strong> é€‰ä¸­æ–‡æœ¬ï¼ŒæŒ‰ <span class="shortcut">d</span> åˆ é™¤</p>
                    <p><strong>é¢„æœŸç»“æœï¼š</strong> é€‰ä¸­çš„æ–‡æœ¬è¢«åˆ é™¤</p>
                </div>
                
                <div class="test-item">
                    <h3>é€‰æ‹©æ–¹å‘åˆ‡æ¢ <span class="status pending">å¾…æµ‹è¯•</span></h3>
                    <p><strong>æµ‹è¯•æ­¥éª¤ï¼š</strong> åœ¨è§†è§‰æ¨¡å¼ä¸‹æŒ‰ <span class="shortcut">o</span></p>
                    <p><strong>é¢„æœŸç»“æœï¼š</strong> å…‰æ ‡åœ¨é€‰æ‹©åŒºåŸŸçš„ä¸¤ç«¯ä¹‹é—´åˆ‡æ¢</p>
                </div>
                
                <div class="text-sample">
                    <h3>æ–‡æœ¬æ“ä½œç»ƒä¹ åŒº</h3>
                    <p>è¿™é‡Œæ˜¯ä¸€ä¸ªå¯ä»¥è‡ªç”±ç¼–è¾‘çš„æ–‡æœ¬åŒºåŸŸã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œç»ƒä¹ å„ç§è§†è§‰æ¨¡å¼æ“ä½œï¼š</p>
                    <p>â€¢ é€‰æ‹©è¿™è¡Œæ–‡å­—å¹¶å¤åˆ¶åˆ°å…¶ä»–åœ°æ–¹</p>
                    <p>â€¢ åˆ é™¤ä¸éœ€è¦çš„æ–‡æœ¬å†…å®¹</p>
                    <p>â€¢ å°è¯•å—é€‰æ‹©æ“ä½œ</p>
                    <p>â€¢ æµ‹è¯•ç²˜è´´åŠŸèƒ½</p>
                    <p>è®°ä½ï¼šv=å­—ç¬¦æ¨¡å¼ï¼ŒV=è¡Œæ¨¡å¼ï¼ŒCtrl+v=å—æ¨¡å¼</p>
                </div>
            </div>

            <div class="selection-indicator">
                <h3>ğŸ“Š é€‰æ‹©çŠ¶æ€æŒ‡ç¤ºå™¨</h3>
                <p id="selection-info">å½“å‰æ²¡æœ‰æ–‡æœ¬è¢«é€‰ä¸­</p>
                <div class="test-results" id="visual-test-results">
                    <strong>æµ‹è¯•ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º...</strong>
                </div>
            </div>

            <div class="warning">
                <h3>âš ï¸ æµ‹è¯•æ³¨æ„äº‹é¡¹</h3>
                <ul>
                    <li>ç¡®ä¿é¡µé¢ç„¦ç‚¹åœ¨æ–‡æœ¬åŒºåŸŸï¼Œè€Œä¸æ˜¯åœ¨è¾“å…¥æ¡†ä¸­</li>
                    <li>æŸäº›æµè§ˆå™¨å¯èƒ½ä¼šæ‹¦æˆª Ctrl+v å¿«æ·é”®ï¼Œè¿™æ˜¯æ­£å¸¸ç°è±¡</li>
                    <li>å¦‚æœè§†è§‰æ¨¡å¼ä¸å·¥ä½œï¼Œè¯·æ£€æŸ¥ rVim æ‰©å±•æ˜¯å¦æ­£ç¡®å®‰è£…</li>
                    <li>æµ‹è¯•æ—¶è¯·è§‚å¯Ÿæ–‡æœ¬çš„é«˜äº®æ˜¾ç¤ºæ•ˆæœ</li>
                    <li>å¤åˆ¶çš„æ–‡æœ¬åº”è¯¥èƒ½å¤Ÿåœ¨å…¶ä»–åº”ç”¨ç¨‹åºä¸­ç²˜è´´</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- åŠ è½½æµ‹è¯•æ‰§è¡Œè„šæœ¬ -->
    <script src="test_execution_script.js"></script>
    
    <script>
        // è§†è§‰æ¨¡å¼åŠŸèƒ½æµ‹è¯•å™¨
        class VisualModeTester {
            constructor() {
                this.visualTests = {};
                this.selectionTests = {};
                this.currentTest = null;
                this.selectionData = {
                    text: '',
                    startPos: null,
                    endPos: null,
                    mode: null
                };
                this.init();
            }

            init() {
                console.log('ğŸ‘ï¸ è§†è§‰æ¨¡å¼æµ‹è¯•å™¨åˆå§‹åŒ–ä¸­...');
                this.setupEventListeners();
                this.checkVisualModeSupport();
            }

            checkVisualModeSupport() {
                console.log('ğŸ” æ£€æŸ¥è§†è§‰æ¨¡å¼æ”¯æŒ...');
                
                const capabilities = {
                    'æ–‡æœ¬é€‰æ‹©API': document.getSelection,
                    'é”®ç›˜äº‹ä»¶': KeyboardEvent,
                    'å‰ªè´´æ¿API': navigator.clipboard,
                    'rVimæ‰©å±•': window.Command || window.Visual
                };

                console.log('ğŸ“Š è§†è§‰æ¨¡å¼æ”¯æŒæ£€æŸ¥ç»“æœ:');
                Object.entries(capabilities).forEach(([name, exists]) => {
                    const status = exists ? 'âœ…' : 'âŒ';
                    console.log(`${status} ${name}: ${exists ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'}`);
                });

                return Object.values(capabilities).filter(Boolean).length >= 3;
            }

            setupEventListeners() {
                // ç›‘å¬é”®ç›˜äº‹ä»¶
                document.addEventListener('keydown', (e) => {
                    this.handleVisualModeKeyPress(e);
                });

                // ç›‘å¬æ–‡æœ¬é€‰æ‹©äº‹ä»¶
                document.addEventListener('selectionchange', () => {
                    this.handleSelectionChange();
                });

                // ç›‘å¬é¼ æ ‡é€‰æ‹©
                document.addEventListener('mouseup', () => {
                    this.handleMouseSelection();
                });
            }

            handleVisualModeKeyPress(e) {
                if (e.target.matches('input, textarea')) return;

                const visualKeys = {
                    'v': 'å­—ç¬¦è§†è§‰æ¨¡å¼',
                    'V': 'è¡Œè§†è§‰æ¨¡å¼',
                    'y': 'å¤åˆ¶æ“ä½œ',
                    'd': 'åˆ é™¤æ“ä½œ',
                    'p': 'ç²˜è´´æ“ä½œ',
                    'o': 'åˆ‡æ¢é€‰æ‹©æ–¹å‘',
                    'Escape': 'é€€å‡ºè§†è§‰æ¨¡å¼'
                };

                // æ£€æŸ¥ Ctrl+v (å—è§†è§‰æ¨¡å¼)
                if (e.ctrlKey && e.key === 'v') {
                    console.log('ğŸ‘ï¸ å—è§†è§‰æ¨¡å¼å¿«æ·é”®: Ctrl+v');
                    this.recordVisualAction('Ctrl+v', 'å—è§†è§‰æ¨¡å¼');
                    e.preventDefault();
                    return;
                }

                if (visualKeys[e.key]) {
                    console.log(`ğŸ‘ï¸ è§†è§‰æ¨¡å¼å¿«æ·é”®: ${e.key} (${visualKeys[e.key]})`);
                    this.recordVisualAction(e.key, visualKeys[e.key]);
                    
                    // å¯¹äºæŸäº›å…³é”®æ“ä½œï¼Œé˜»æ­¢é»˜è®¤è¡Œä¸º
                    if (['v', 'V', 'y', 'd'].includes(e.key)) {
                        e.preventDefault();
                    }
                }
            }

            handleSelectionChange() {
                const selection = document.getSelection();
                if (selection.rangeCount > 0) {
                    const range = selection.getRangeAt(0);
                    const selectedText = selection.toString();
                    
                    if (selectedText.length > 0) {
                        this.selectionData = {
                            text: selectedText,
                            startPos: range.startOffset,
                            endPos: range.endOffset,
                            mode: this.detectSelectionMode(selectedText),
                            timestamp: Date.now()
                        };
                        
                        this.updateSelectionIndicator(selectedText);
                        console.log('ğŸ“ æ–‡æœ¬é€‰æ‹©å˜åŒ–:', this.selectionData);
                    }
                }
            }

            handleMouseSelection() {
                const selection = document.getSelection();
                const selectedText = selection.toString();
                
                if (selectedText.length > 0) {
                    console.log('ğŸ–±ï¸ é¼ æ ‡é€‰æ‹©æ–‡æœ¬:', selectedText.substring(0, 50) + (selectedText.length > 50 ? '...' : ''));
                    this.recordSelectionAction('mouse', selectedText.length);
                }
            }

            detectSelectionMode(text) {
                if (text.includes('\n')) {
                    const lines = text.split('\n');
                    if (lines.length > 1) {
                        return lines.every(line => line.length > 0) ? 'è¡Œæ¨¡å¼' : 'å—æ¨¡å¼';
                    }
                }
                return 'å­—ç¬¦æ¨¡å¼';
            }

            updateSelectionIndicator(text) {
                const indicator = document.getElementById('selection-info');
                if (indicator) {
                    const preview = text.length > 100 ? text.substring(0, 100) + '...' : text;
                    indicator.innerHTML = `
                        <strong>å·²é€‰æ‹©æ–‡æœ¬:</strong> "${preview}"<br>
                        <strong>é•¿åº¦:</strong> ${text.length} å­—ç¬¦<br>
                        <strong>æ¨¡å¼:</strong> ${this.selectionData.mode}<br>
                        <strong>æ—¶é—´:</strong> ${new Date().toLocaleTimeString()}
                    `;
                }
            }

            recordVisualAction(key, action) {
                if (!this.visualTests.keyActions) {
                    this.visualTests.keyActions = [];
                }

                this.visualTests.keyActions.push({
                    key,
                    action,
                    timestamp: Date.now(),
                    selectionActive: document.getSelection().toString().length > 0
                });
            }

            recordSelectionAction(method, textLength) {
                if (!this.selectionTests.selections) {
                    this.selectionTests.selections = [];
                }

                this.selectionTests.selections.push({
                    method,
                    textLength,
                    timestamp: Date.now()
                });
            }

            startVisualModeTest() {
                this.currentTest = 'è§†è§‰æ¨¡å¼æµ‹è¯•';
                console.log('ğŸ‘ï¸ å¼€å§‹è§†è§‰æ¨¡å¼æµ‹è¯•...');
                
                if (window.tester) {
                    window.tester.startTest('è§†è§‰æ¨¡å¼æµ‹è¯•');
                }

                this.updateTestStatus('è§†è§‰æ¨¡å¼', 'testing');
                
                console.log(`
ğŸ“‹ è§†è§‰æ¨¡å¼æµ‹è¯•æ­¥éª¤:
1. æŒ‰ v é”®è¿›å…¥å­—ç¬¦è§†è§‰æ¨¡å¼
2. æŒ‰ V é”®è¿›å…¥è¡Œè§†è§‰æ¨¡å¼
3. æŒ‰ Ctrl+v è¿›å…¥å—è§†è§‰æ¨¡å¼
4. ä½¿ç”¨ hjkl æˆ–æ–¹å‘é”®ç§»åŠ¨é€‰æ‹©
5. æŒ‰ y å¤åˆ¶ï¼ŒæŒ‰ d åˆ é™¤ï¼ŒæŒ‰ p ç²˜è´´
6. æŒ‰ Esc é€€å‡ºè§†è§‰æ¨¡å¼

ğŸ’¡ æç¤º: è¯·åœ¨æ–‡æœ¬åŒºåŸŸä¸­è¿›è¡Œæµ‹è¯•ï¼Œè§‚å¯Ÿé€‰æ‹©é«˜äº®æ•ˆæœ`);
            }

            startTextSelectionTest() {
                this.currentTest = 'æ–‡æœ¬é€‰æ‹©æµ‹è¯•';
                console.log('ğŸ“ å¼€å§‹æ–‡æœ¬é€‰æ‹©æµ‹è¯•...');
                
                if (window.tester) {
                    window.tester.startTest('æ–‡æœ¬é€‰æ‹©æµ‹è¯•');
                }

                this.updateTestStatus('æ–‡æœ¬é€‰æ‹©', 'testing');
                
                console.log(`
ğŸ“‹ æ–‡æœ¬é€‰æ‹©æµ‹è¯•æ­¥éª¤:
1. ä½¿ç”¨é¼ æ ‡æ‹–æ‹½é€‰æ‹©æ–‡æœ¬
2. åŒå‡»é€‰æ‹©å•è¯
3. ä¸‰å‡»é€‰æ‹©æ•´è¡Œ
4. ä½¿ç”¨é”®ç›˜å¿«æ·é”®é€‰æ‹©
5. æµ‹è¯•å¤åˆ¶ç²˜è´´åŠŸèƒ½

ğŸ’¡ æç¤º: é€‰æ‹©çš„æ–‡æœ¬ä¿¡æ¯ä¼šåœ¨é€‰æ‹©çŠ¶æ€æŒ‡ç¤ºå™¨ä¸­æ˜¾ç¤º`);
            }

            updateTestStatus(testName, status) {
                const statusElements = document.querySelectorAll('.status');
                statusElements.forEach(el => {
                    const testItem = el.closest('.test-item');
                    if (testItem && testItem.querySelector('h3').textContent.includes(testName)) {
                        el.className = `status ${status}`;
                        el.textContent = status === 'passed' ? 'âœ… é€šè¿‡' : 
                                       status === 'failed' ? 'âŒ å¤±è´¥' : 
                                       status === 'testing' ? 'ğŸ”„ æµ‹è¯•ä¸­' : 'â³ å¾…æµ‹è¯•';
                    }
                });
            }

            endTest(testName, status, notes = []) {
                console.log(`âœ… æµ‹è¯•å®Œæˆ: ${testName} (${status})`);
                
                if (window.tester) {
                    window.tester.endTest(testName, status, notes);
                }

                this.updateTestStatus(testName, status);
                this.currentTest = null;
                
                // æ›´æ–°æµ‹è¯•ç»“æœæ˜¾ç¤º
                this.updateTestResults();
            }

            updateTestResults() {
                const resultsElement = document.getElementById('visual-test-results');
                if (resultsElement) {
                    const results = this.getVisualModeResults();
                    resultsElement.innerHTML = `
                        <strong>æµ‹è¯•ç»Ÿè®¡:</strong><br>
                        â€¢ è§†è§‰æ¨¡å¼æ“ä½œ: ${results.summary.totalVisualActions} æ¬¡<br>
                        â€¢ æ–‡æœ¬é€‰æ‹©: ${results.summary.totalSelections} æ¬¡<br>
                        â€¢ æœ€åæ´»åŠ¨: ${results.summary.lastActivity ? new Date(results.summary.lastActivity).toLocaleTimeString() : 'æ— '}<br>
                        â€¢ å½“å‰æµ‹è¯•: ${this.currentTest || 'æ— '}
                    `;
                }
            }

            getVisualModeResults() {
                return {
                    visualTests: this.visualTests,
                    selectionTests: this.selectionTests,
                    selectionData: this.selectionData,
                    currentTest: this.currentTest,
                    summary: this.generateSummary()
                };
            }

            generateSummary() {
                return {
                    totalVisualActions: this.visualTests.keyActions ? this.visualTests.keyActions.length : 0,
                    totalSelections: this.selectionTests.selections ? this.selectionTests.selections.length : 0,
                    lastActivity: Math.max(
                        ...(this.visualTests.keyActions || []).map(a => a.timestamp),
                        ...(this.selectionTests.selections || []).map(s => s.timestamp)
                    ) || null
                };
            }

            // æ¨¡æ‹Ÿè§†è§‰æ¨¡å¼æ“ä½œ
            simulateVisualMode(mode) {
                console.log(`ğŸ­ æ¨¡æ‹Ÿ${mode}è§†è§‰æ¨¡å¼...`);
                
                const selection = document.getSelection();
                if (selection.rangeCount > 0) {
                    const range = selection.getRangeAt(0);
                    const text = selection.toString();
                    
                    console.log(`ğŸ“ æ¨¡æ‹Ÿé€‰æ‹©æ–‡æœ¬: "${text.substring(0, 50)}${text.length > 50 ? '...' : ''}"`);
                    
                    this.recordVisualAction(mode, `æ¨¡æ‹Ÿ${mode}æ¨¡å¼é€‰æ‹©`);
                    return text;
                }
                
                return null;
            }

            // æ¨¡æ‹Ÿå¤åˆ¶æ“ä½œ
            simulateCopy() {
                const text = document.getSelection().toString();
                if (text) {
                    console.log(`ğŸ“‹ æ¨¡æ‹Ÿå¤åˆ¶æ“ä½œ: "${text.substring(0, 30)}${text.length > 30 ? '...' : ''}"`);
                    
                    // å°è¯•ä½¿ç”¨å‰ªè´´æ¿ API
                    if (navigator.clipboard) {
                        navigator.clipboard.writeText(text).then(() => {
                            console.log('âœ… æ–‡æœ¬å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                        }).catch(err => {
                            console.log('âŒ å¤åˆ¶å¤±è´¥:', err);
                        });
                    }
                    
                    this.recordVisualAction('y', 'å¤åˆ¶æ“ä½œ');
                    return text;
                }
                return null;
            }
        }

        // åˆ›å»ºè§†è§‰æ¨¡å¼æµ‹è¯•å™¨å®ä¾‹
        window.visualModeTester = new VisualModeTester();

        // æµ‹è¯•æ§åˆ¶å‡½æ•°
        function startVisualModeTest() {
            window.visualModeTester.startVisualModeTest();
        }

        function startTextSelectionTest() {
            window.visualModeTester.startTextSelectionTest();
        }

        function checkVisualModeResults() {
            const results = window.visualModeTester.getVisualModeResults();
            console.log('ğŸ“Š è§†è§‰æ¨¡å¼æµ‹è¯•ç»“æœ:', results);
            return results;
        }

        function exportVisualModeResults() {
            const results = checkVisualModeResults();
            const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `visual-mode-test-results-${new Date().toISOString().slice(0, 19).replace(/:/g, '-')}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            console.log('ğŸ’¾ è§†è§‰æ¨¡å¼æµ‹è¯•ç»“æœå·²å¯¼å‡º');
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const extensionLoaded = window.tester && window.tester.checkExtensionStatus();
                const statusElement = document.getElementById('extension-status');
                if (statusElement) {
                    if (extensionLoaded) {
                        statusElement.innerHTML = 'ğŸŸ¢ æ‰©å±•å·²åŠ è½½ï¼Œå¯ä»¥å¼€å§‹è§†è§‰æ¨¡å¼æµ‹è¯•';
                        statusElement.className = 'status passed';
                    } else {
                        statusElement.innerHTML = 'ğŸ”´ æ‰©å±•æœªåŠ è½½ï¼Œè¯·æ£€æŸ¥å®‰è£…çŠ¶æ€';
                        statusElement.className = 'status failed';
                    }
                }

                console.log('ğŸ¯ è§†è§‰æ¨¡å¼æµ‹è¯•é¡µé¢å·²å°±ç»ª');
                console.log('ğŸ’¡ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œæµ‹è¯•:');
                console.log('  - startVisualModeTest() - å¼€å§‹è§†è§‰æ¨¡å¼æµ‹è¯•');
                console.log('  - startTextSelectionTest() - å¼€å§‹æ–‡æœ¬é€‰æ‹©æµ‹è¯•');
                console.log('  - checkVisualModeResults() - æŸ¥çœ‹æµ‹è¯•ç»“æœ');
                console.log('  - exportVisualModeResults() - å¯¼å‡ºæµ‹è¯•ç»“æœ');
                
                // å®šæœŸæ›´æ–°æµ‹è¯•ç»“æœæ˜¾ç¤º
                setInterval(() => {
                    window.visualModeTester.updateTestResults();
                }, 2000);
            }, 1500);
        });
    </script>
</body>
</html>