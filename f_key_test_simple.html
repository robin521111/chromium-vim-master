<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fé”®åŠŸèƒ½æµ‹è¯• - rVim</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .link-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .test-link {
            display: block;
            padding: 15px;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            text-align: center;
            transition: background-color 0.3s;
        }
        .test-link:hover {
            background: #0056b3;
            color: white;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .instructions {
            background: #e7f3ff;
            padding: 15px;
            border-left: 4px solid #007bff;
            margin: 20px 0;
        }
        .code {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            border: 1px solid #dee2e6;
        }
        button {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #218838;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ Fé”®åŠŸèƒ½æµ‹è¯•é¡µé¢</h1>
    
    <div class="instructions">
        <h3>ğŸ“‹ æµ‹è¯•è¯´æ˜</h3>
        <ol>
            <li><strong>æŒ‰ F é”®</strong> - åº”è¯¥æ˜¾ç¤ºé“¾æ¥æç¤ºï¼ˆå­—æ¯æ ‡ç­¾ï¼‰</li>
            <li><strong>æŒ‰ Shift+F é”®</strong> - åº”è¯¥åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€é“¾æ¥</li>
            <li>å¦‚æœæ²¡æœ‰ååº”ï¼Œè¯´æ˜æ‰©å±•æœªæ­£ç¡®åŠ è½½</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>ğŸ” æ‰©å±•çŠ¶æ€æ£€æŸ¥</h2>
        <button onclick="checkExtensionStatus()">æ£€æŸ¥æ‰©å±•çŠ¶æ€</button>
        <div id="extensionStatus"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ”— æµ‹è¯•é“¾æ¥åŒºåŸŸ</h2>
        <p>åœ¨ä¸‹é¢çš„é“¾æ¥åŒºåŸŸæŒ‰ <code>F</code> é”®æµ‹è¯•åŠŸèƒ½ï¼š</p>
        
        <div class="link-container">
            <a href="https://www.google.com" class="test-link">Google æœç´¢</a>
            <a href="https://www.github.com" class="test-link">GitHub</a>
            <a href="https://www.stackoverflow.com" class="test-link">Stack Overflow</a>
            <a href="https://www.mozilla.org" class="test-link">Mozilla</a>
            <a href="https://www.w3.org" class="test-link">W3C</a>
            <a href="https://developer.mozilla.org" class="test-link">MDN Web Docs</a>
        </div>
    </div>

    <div class="test-section">
        <h2>âŒ¨ï¸ é”®ç›˜äº‹ä»¶æµ‹è¯•</h2>
        <button onclick="testKeyboardEvents()">æµ‹è¯•é”®ç›˜ç›‘å¬</button>
        <div id="keyboardTest"></div>
        <div class="code" id="keyLog" style="display: none; margin-top: 10px; max-height: 200px; overflow-y: auto;"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ› ï¸ æ‰‹åŠ¨Fé”®æµ‹è¯•</h2>
        <button onclick="manualFKeyTest()">æ‰‹åŠ¨è°ƒç”¨ Hints.create()</button>
        <div id="manualTestResult"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š è¯Šæ–­ä¿¡æ¯</h2>
        <button onclick="showDiagnostics()">æ˜¾ç¤ºè¯¦ç»†è¯Šæ–­</button>
        <div id="diagnostics"></div>
    </div>

    <script>
        let keyLogger = [];
        let isLogging = false;

        function checkExtensionStatus() {
            const statusDiv = document.getElementById('extensionStatus');
            let html = '';
            
            // æ£€æŸ¥ä¸»è¦å¯¹è±¡
            const objects = [
                { name: 'Hints', obj: window.Hints },
                { name: 'HUD', obj: window.HUD },
                { name: 'Mappings', obj: window.Mappings },
                { name: 'Command', obj: window.Command }
            ];
            
            let allLoaded = true;
            objects.forEach(obj => {
                const loaded = typeof obj.obj !== 'undefined';
                if (!loaded) allLoaded = false;
                
                html += `<div class="status ${loaded ? 'success' : 'error'}">`;
                html += `${obj.name}: ${loaded ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½'}`;
                html += '</div>';
            });
            
            if (allLoaded) {
                html += '<div class="status success">ğŸ‰ æ‰€æœ‰æ ¸å¿ƒå¯¹è±¡å·²åŠ è½½ï¼ŒFé”®åº”è¯¥å¯ä»¥å·¥ä½œï¼</div>';
            } else {
                html += '<div class="status error">âš ï¸ æ‰©å±•æœªå®Œå…¨åŠ è½½ï¼Œè¯·æ£€æŸ¥æ‰©å±•å®‰è£…</div>';
            }
            
            statusDiv.innerHTML = html;
        }

        function testKeyboardEvents() {
            const testDiv = document.getElementById('keyboardTest');
            const logDiv = document.getElementById('keyLog');
            
            if (!isLogging) {
                isLogging = true;
                keyLogger = [];
                testDiv.innerHTML = '<div class="status warning">ğŸ¯ é”®ç›˜ç›‘å¬å·²å¯åŠ¨ï¼Œè¯·æŒ‰ F é”®...</div>';
                logDiv.style.display = 'block';
                logDiv.innerHTML = 'é”®ç›˜äº‹ä»¶æ—¥å¿—ï¼š\n';
                
                document.addEventListener('keydown', logKeyEvent);
                document.addEventListener('keyup', logKeyEvent);
                
                setTimeout(() => {
                    document.removeEventListener('keydown', logKeyEvent);
                    document.removeEventListener('keyup', logKeyEvent);
                    isLogging = false;
                    testDiv.innerHTML += '<div class="status success">âœ… é”®ç›˜ç›‘å¬å·²åœæ­¢</div>';
                }, 10000);
            }
        }

        function logKeyEvent(event) {
            const logDiv = document.getElementById('keyLog');
            const logEntry = `${event.type}: ${event.key} (code: ${event.code})\n`;
            keyLogger.push(logEntry);
            logDiv.textContent += logEntry;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function manualFKeyTest() {
            const resultDiv = document.getElementById('manualTestResult');
            
            if (typeof window.Hints !== 'undefined' && typeof window.Hints.create === 'function') {
                try {
                    window.Hints.create();
                    resultDiv.innerHTML = '<div class="status success">âœ… Hints.create() è°ƒç”¨æˆåŠŸï¼</div>';
                } catch (error) {
                    resultDiv.innerHTML = `<div class="status error">âŒ Hints.create() è°ƒç”¨å¤±è´¥: ${error.message}</div>`;
                }
            } else {
                resultDiv.innerHTML = '<div class="status error">âŒ Hints.create å‡½æ•°ä¸å¯ç”¨</div>';
            }
        }

        function showDiagnostics() {
            const diagDiv = document.getElementById('diagnostics');
            let html = '<h4>ğŸ” è¯¦ç»†è¯Šæ–­ä¿¡æ¯</h4>';
            
            // æµè§ˆå™¨ä¿¡æ¯
            html += `<div class="code">æµè§ˆå™¨: ${navigator.userAgent}</div>`;
            
            // é¡µé¢ä¿¡æ¯
            html += `<div class="code">é¡µé¢URL: ${window.location.href}</div>`;
            html += `<div class="code">åè®®: ${window.location.protocol}</div>`;
            
            // æ‰©å±•ä¸Šä¸‹æ–‡
            html += `<div class="code">Chromeæ‰©å±•API: ${typeof chrome !== 'undefined' ? 'å¯ç”¨' : 'ä¸å¯ç”¨'}</div>`;
            
            // Content Scriptsæ£€æŸ¥
            const scripts = ['Hints', 'HUD', 'Mappings', 'Command', 'Utils', 'DOM'];
            html += '<div class="code">Content ScriptsçŠ¶æ€:\n';
            scripts.forEach(script => {
                html += `  ${script}: ${typeof window[script] !== 'undefined' ? 'âœ…' : 'âŒ'}\n`;
            });
            html += '</div>';
            
            // CSSæ£€æŸ¥
            const hasCSS = document.querySelector('style[data-rvim]') || 
                          document.querySelector('link[href*="main.css"]') ||
                          document.querySelector('style').textContent.includes('rvim');
            html += `<div class="code">CSSæ³¨å…¥: ${hasCSS ? 'âœ… æ£€æµ‹åˆ°' : 'âŒ æœªæ£€æµ‹åˆ°'}</div>`;
            
            diagDiv.innerHTML = html;
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', function() {
            setTimeout(() => {
                checkExtensionStatus();
            }, 1000);
        });

        // ç›‘å¬Fé”®
        document.addEventListener('keydown', function(event) {
            if (event.key === 'f' || event.key === 'F') {
                console.log('Fé”®è¢«æŒ‰ä¸‹ï¼Œæ£€æŸ¥æ˜¯å¦è§¦å‘Hints.create');
            }
        });
    </script>
</body>
</html>